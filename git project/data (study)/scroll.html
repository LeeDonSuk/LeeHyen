<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>scroll.html</title>
</head>
<style>
    img {
        width: 100%;
        opacity: 0;
        transform: translateX(-100%);
        transition: .5s;
    }

    img.active {
        opacity: 1;
        transform: translateX(0%);
    }
</style>

<body style="width: 100%; margin: 0 auto;">
    <!-- scroll.html -->
    <article style="height: 2000px;">
        <h2>콘텐츠 위치 확인후 활성화</h2>
        <figure>
            <p>
                <img src="./imgs/common1.jpg">
            </p>
            <p>
                <img src="./imgs/common2.jpg">
            </p>
            <p>
                <img src="./imgs/common3.jpg">
            </p>
            <p>
                <img src="./imgs/common4.jpg">
            </p>
            <p>
                <img src="./imgs/common1.jpg">
            </p>
            <p>
                <img src="./imgs/common2.jpg">
            </p>
            <p>
                <img src="./imgs/common3.jpg">
            </p>
        </figure>
    </article>
    <script>
        function init() { // 부모 함수
            contentScroll();
            function contentScroll() {
                const elImg = document.querySelectorAll('img'); // 이미지 엘리먼트들을 선택합니다.
                let winH = window.innerHeight / 2; // 현재 브라우저 창의 내부 높이를 2로 나눈 값을 winH 변수에 저장합니다.
                let imgArr = []; // 이미지 위치 정보를 담을 배열을 생성합니다.

                elImg.forEach(function (ele) {
                    imgArr.push(ele.getBoundingClientRect()); // 각 이미지의 위치 정보를 imgArr 배열에 저장합니다.
                });
                function scrollfun() { // 자식 함수
                    imgArr.forEach(function (offset, key) {
                        console.log(offset.y); // 현재 스크롤의 위치를 콘솔에 출력합니다.
                        if (window.pageYOffset > offset.y - winH) {
                            elImg[key].classList.add('active'); // 스크롤 위치에 따라 이미지의 클래스를 변경하여 애니메이션 등의 효과를 부여합니다.
                        }
                    });
                }
                console.log(imgArr); // 이미지 위치 정보를 콘솔에 출력합니다.

                window.onscroll = scrollfun;
                // 스크롤할 때 scrollfun 함수가 실행되도록 이벤트 핸들러를 등록합니다.
            }
        }

        window.onload = init; // 웹 페이지가 완전히 로드되었을 때 init 함수를 실행합니다.
    </script>
    <script>
        const elImgs = document.querySelectorAll('img');

        const io = new IntersectionObserver(entries => {
            entries.forEach(entries => {
                if (entry.intersectionRatio > 0) {
                    entry.target.classList.add('active');
                }
            })
        })
        const boxEllist = document.querySelectorAll('img');
        boxEllist.forEach((el) => {
            io.observe(el)
        })
    </script>

</body>

</html>